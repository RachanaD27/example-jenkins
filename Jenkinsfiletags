pipeline { 
	agent any 	
	stages {
	   
	    stage('Checkout SCM') {
            steps {
                checkout([$class: 'GitSCM',
                       // branches: [[name: '*/main']],
                        branches: [[name: "${params.Tags}"]],
                        doGenerateSubmoduleConfigurations: false,
                        extensions: [[$class: 'CleanCheckout']],
                        submoduleCfg: [],
                        userRemoteConfigs: [[url: 'https://github.com/RachanaD27/example-jenkins.git']]
                ])
            }
        }
        
        stage('Tag') {
            steps {
                script {
                    env.POM_VERSION = readMavenPom().getVersion()
}

// creating the name of the tag

bat '''#!/bin/bash -xe
currentDate=$(date +"%Y-%m-%d_%Hh%Mm%Ss")
customTagName="${CUSTOMER_NAME}--${POM_VERSION}--${currentDate}"
echo CUSTOM_TAG_NAME=${customTagName} >> ${PROPERTIES_FILE_NAME}
'''
script {
def PROPERTIES = readProperties file: "${PROPERTIES_FILE_NAME}"
env.CUSTOM_TAG_NAME = PROPERTIES.CUSTOM_TAG_NAME
}
withCredentials([[$class: 'GitSCM']]) {
bat ("git tag -a ${CUSTOM_TAG_NAME} -m 'Jenkins'")
bat("git push https://github.com/RachanaD27/example-jenkins.git ${CUSTOM_TAG_NAME}")
}
}
}


        
		/* dev deployment starts here*/
		
/*stage('Build and Deploy to Anypoint platform DEV environment'){

			 steps {
						script{
                            
                            def deployenv ="dev"

                            def version = "${env.dev_DEPLOY_MULE_VERSION}"
                    		def deployusername="${env.dev_DEPLOY_USERNAME}" 
							def deploypassword="${env.dev_DEPLOY_PASSWORD}" 
							def deployvCore="${env.dev_DEPLOY_VCORE}"
							def deployworkers="${env.dev_DEPLOY_WORKERS}" 
					
                            bat """mvn clean deploy -DmuleDeploy -DskipTests -Dmule.version=${version} -Danypoint.username=${deployusername} -Danypoint.password=${deploypassword} -Denv=${deployenv} -DvCore=${deployvCore} -Dworkers=${deployworkers} -Dproperties=${deployenv}"""
                    
}
}
}*/
	
}
}

